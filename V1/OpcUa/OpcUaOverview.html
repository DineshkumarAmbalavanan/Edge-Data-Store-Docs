<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>OPC UA EDS adapter </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="OPC UA EDS adapter ">
    <meta name="generator" content="docfx 2.43.2.0">
    
    <link rel="shortcut icon" href="../../favicon.ico">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="../../toc.html">
    <meta property="docfx:tocrel" content="../../toc.html">
    
    <meta property="docfx:rel" content="../../">
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand" href="../../V1/index.html" width="46">
                <img id="logo" src="../../V1/images/atlas_icon.png" height="46" width="46" alt="OSIsoft Edge System"> 
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list"></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        <div class="article row grid">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="opcUaOverview">
<h1 id="opc-ua-eds-adapter">OPC UA EDS adapter</h1>

<h2 id="overview">Overview</h2>
<p>The OPC UA EDS adapter transfers time-series data from OPC UA devices into Edge Data Store.</p>
<p>You can add a single OPC UA EDS adapter during installation. If you want multiple OPC UA EDS adapters, see <a class="xref" href="../Configuration/EdgeSystemConfiguration.html">Edge Data Store Configuration</a> on how to add a new component to Edge Data Store. The following example explains how to configure the first adapter. If another adapter has been installed, substitute the name of the installed adapter in the below example for OpcUa1.</p>
<p>As with other EDS adapters, the OPC UA EDS adapter is configured with data source and data selection JSON documents. The data source configurations are identical with other adapters, but OPC UA supports an option to generate a data selection file template that you can manually edit and use for subsequent configuration. See <a class="xref" href="OpcUaDataSelection.html">OPC UA Data Selection</a> for details. Once you create a template file, you can reuse it on both Linux and Windows without changes.</p>
<p>OPC UA is an open standard, which ensures interoperability, security, and reliability of industrial automation devices and systems. OPC UA is recognized as one of the key communication and data modeling technologies of Industry 4.0, due to the fact that it works with many software platforms, and is completely scalable and flexible.</p>
<h2 id="supported-features">Supported features</h2>
<h3 id="data-types">Data Types</h3>
<p>The table below lists OPC UA variable types that the OPC UA EDS adapter supports data collection from and types of streams that are going to be created in Edge Data Store.</p>
<table>
<thead>
<tr>
<th>OPC UA data type</th>
<th>Stream data type</th>
</tr>
</thead>
<tbody>
<tr>
<td>Boolean</td>
<td>Boolean</td>
</tr>
<tr>
<td>Byte</td>
<td>Int16</td>
</tr>
<tr>
<td>SByte</td>
<td>Int16</td>
</tr>
<tr>
<td>Int16</td>
<td>Int16</td>
</tr>
<tr>
<td>UInt16</td>
<td>UInt16</td>
</tr>
<tr>
<td>Int32</td>
<td>Int32</td>
</tr>
<tr>
<td>UInt32</td>
<td>UInt32</td>
</tr>
<tr>
<td>Int64</td>
<td>Int64</td>
</tr>
<tr>
<td>UInt64</td>
<td>UInt64</td>
</tr>
<tr>
<td>Float</td>
<td>Float32</td>
</tr>
<tr>
<td>Double</td>
<td>Float64</td>
</tr>
<tr>
<td>DateTime</td>
<td>DateTime</td>
</tr>
<tr>
<td>String</td>
<td>String</td>
</tr>
</tbody>
</table>
<h3 id="export-operation">Export operation</h3>
<p>The OPC UA EDS adapter is able to export available OPC UA dynamic variables by browsing the OPC UA hierarchies or sub-hierarchies. Browse can be limited by specifying comma separated collection of nodeIds in data source configuration (RootNodeIds) which are going to be treated as a root(s) from where the adapter starts the browse operation. The adapter triggers export operation after successful connection to the OPC UA server when the data selection file doesn&#39;t exist in configuration directory. The exported data selection JSON file can be copied from the directory or retrieved via REST API call.</p>
<p>Data selection file can be also created manually in order to avoid potentially long and expensive browse operation and configured before configuring data source or pushed in one configuration call with data source configuration.</p>
<h2 id="operational-overview">Operational overview</h2>
<h3 id="adapter-configuration">Adapter configuration</h3>
<p>In order for the OPC UA EDS adapter to start data collection, you need to configure the adapter. For more information, see <strong>Configuration of OPC UA data source</strong> and <strong>Configuration of OPC UA data selection</strong>. To configure the adapter, configure the following:</p>
<p>Data source: Provide the information of the data source from where the adapter should collect data.
Data selection: Perform selection of OPC UA items that adapter should should subscribe for data.</p>
<h2 id="network-communication">Network communication</h2>
<p>The OPC UA EDS adapter communicates with the OPC UA server through TCP/IP network using opc.tcp binary protocol.</p>
<h3 id="stream-creation">Stream creation</h3>
<p>The OPC UA EDS adapter creates types upon receiving the value update for a stream from OPC UA subscription per stream and streams are created for selected OPC UA items in the data selection configuration. One stream is going to be created in Edge Data Store for every selected OPC UA item in data selection configuration.</p>
<h3 id="connection">Connection</h3>
<p>The OPC UA EDS adapter uses binary opc.tcp protocol to communicate with the OPC UA servers. The X.509-type client and server certificates are exchanged and verified (when security is enabled) and the connection to the configured OPC UA server is established.</p>
<h3 id="data-collection">Data collection</h3>
<p>OPC UA EDS adapter is collecting time-series data from selected OPC UA dynamic variables through OPC UA subscriptions (unsolicited reads). This version of adapter supports Data Access (DA) part of OPC UA specification.</p>
<h3 id="streams-created-by-opc-ua-eds-adapter">Streams created by OPC UA EDS adapter</h3>
<p>OPC UA EDS adapter creates a stream with two properties per selected OPC UA item. The properties are defined in the following table:</p>
<table>
<thead>
<tr>
<th>Property name</th>
<th>Data type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Timestamp</td>
<td>DateTime</td>
<td>Timestamp of the given OPC UA item value update.</td>
</tr>
<tr>
<td>Value</td>
<td>Based on type of incoming OPC UA value</td>
<td>Value of the given the OPC UA item value update.</td>
</tr>
</tbody>
</table>
<p>Stream ID is a unique identifier of each stream created by the adapter for a given OPC UA item. In case the Custom Stream ID is specified for the OPC UA item in data selection configuration, the OPC UA EDS adapter is going to use that as a stream ID for the stream. Otherwise, the adapter constructs the stream ID using the following format constructed from OPC UA item node ID:</p>
<pre><code>&lt;Adapter Component ID&gt;.&lt;Namespace&gt;.&lt;Identifier&gt;
</code></pre><blockquote><p><strong>Note:</strong> Naming convention is affected by StreamIdPrefix and ApplyPrefixToStreamID settings in data source configuration. For more informaton please refer to <strong>Configuration of OPC UA data source</strong> section.</p>
</blockquote>
<h2 id="configuration-of-opc-ua-data-source">Configuration of OPC UA data source</h2>
<p>To use the OPC UA EDS adapter, you must configure from which OPC UA data source it will be receiving data.</p>
<h3 id="procedure">Procedure</h3>
<blockquote><p><strong>Note:</strong> You cannot modify OPC UA data source configurations manually. You must use the REST endpoints to add or edit the configuration.</p>
</blockquote>
<p>Complete the following to configure the OPC UA data source:</p>
<ol>
<li>Using any text editor, create a file that contains an OPC UA data source in JSON form.<ul>
<li>For content structure, see the following OPC UA data source example section.</li>
<li>For a table of all available parameters, see the following <strong>Parameters for OPC UA data source</strong> section.</li>
</ul>
</li>
<li>Save the file as <em>DataSource.config.json</em>.</li>
<li>Use any <a class="xref" href="../Administration/ManagementTools.html">tool</a> capable of making HTTP requests to execute a POST command with the contents of that file to the following endpoint: <code>http://localhost:5590/api/v1/configuration/&lt;EDS adapterId&gt;/DataSource/</code>. </li>
</ol>
<blockquote><p><strong>Note:</strong> During installation it is possible to add a single OPC UA EDS adapter, and it is named OpcUa1. The example below uses this component name.</p>
</blockquote>
<p>Example using cURL:</p>
<pre><code class="lang-bash">curl -v -d &quot;@DataSource.config.json&quot; -H &quot;Content-Type: application/json&quot; -X POST &quot;http://localhost:5590/api/v1/configuration/OpcUa1/DataSource&quot;
</code></pre><h3 id="parameters-for-opc-ua-data-source">Parameters for OPC UA data source</h3>
<p>The following parameters are available for configuring an OPC UA data source.</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Required</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>EndpointURL</strong></td>
<td>Required</td>
<td>string</td>
<td>The endpoint URL of the OPC UA server. The following is an example of the URL format: opc.tcp://OPCServerHost:Port/OpcUa/SimulationServer<br><br><strong>Note:</strong> If you change the EndpointURL on a configured OPC UA EDS adapter that has ComponentID_DataSelection.json file exported, you will need to relocate the ComponentID_DataSelection.json file from the configuration directory to trigger a new browse (export).</td>
</tr>
<tr>
<td><strong>UseSecureConnection</strong></td>
<td>Optional</td>
<td>bool</td>
<td>When set to true, the OPC UA EDS adapter connects to a secure endpoint using OPC UA certificate exchange operation. The default is true. When set to false, the OPC UA EDS adapter connects to an unsecured endpoint of the server and certificate exchange operation is not required.<br><br><strong>Note:</strong> OSIsoft recommends setting this option to false for testing purposes only.</td>
</tr>
<tr>
<td><strong>UserName</strong></td>
<td>Optional</td>
<td>string</td>
<td>User name for accessing the OPC UA server.</td>
</tr>
<tr>
<td><strong>Password</strong></td>
<td>Optional</td>
<td>string</td>
<td>Password for accessing the OPC UA server.<br><br><strong>Note:</strong> OSIsoft recommends using REST to configure the data source when the password must be specified.</td>
</tr>
<tr>
<td><strong>RootNodeIds</strong></td>
<td>Optional</td>
<td>string</td>
<td>List of comma-separated NodeIds of those objects from which the OPC UA EDS adapter browses the OPC UA server address space. This option allows selecting only subsets of the OPC UA address by explicitly listing one or more NodeIds which are used to start the initial browse. For example: ns=5;s=85/0:Simulation, ns=3;s=DataItems. If not specified, it means that the whole address space will be browsed.</td>
</tr>
<tr>
<td><strong>IncomingTimestamp</strong></td>
<td>Optional</td>
<td>string</td>
<td>Specifies whether the incoming timestamp is taken from the source, from the OPC UA server, or should be created by the OPC UA EDS adapter instance. <strong>Source</strong> - Default and recommended setting. The timestamp is taken from the source timestamp field. The source is what provides data for the item to the OPC UA server, such as a field device. <strong>Server</strong> - In case the OPC UA item has an invalid source timestamp field, the Server timestamp can be used. <strong>Connector</strong> - The OPC UA EDS adapter generates a timestamp for the item upon receiving it from the OPC UA server.</td>
</tr>
<tr>
<td><strong>StreamIdPrefix</strong></td>
<td>Optional</td>
<td>string</td>
<td>Specifies what prefix is used for Stream IDs. Naming convention is StreamIdPrefixNodeId. <strong>Note:</strong> An empty string means no prefix will be added to the Stream IDs. Null value means ComponentID followed by dot character will be added to the stream IDs (example: OpcUa1.NodeId).</td>
</tr>
</tbody>
</table>
<h3 id="opc-ua-data-source-example">OPC UA data source example</h3>
<p>The following is an example of valid OPC UA data source configuration:</p>
<pre><code class="lang-json">{
    &quot;EndpointUrl&quot;: &quot;opc.tcp://IP-Address/TestOPCUAServer&quot;,
    &quot;UseSecureConnection&quot;: true,
    &quot;UserName&quot;: null,
    &quot;Password&quot;: null,
    &quot;RootNodeIds&quot;: null,
    &quot;IncomingTimestamp&quot;: &quot;Source&quot;,
    &quot;StreamIdPrefix&quot;: null
}
</code></pre><h2 id="configuration-of-opc-ua-data-selection">Configuration of OPC UA data selection</h2>
<p>In addition to the data source configuration, you need to provide a data selection configuration to specify the data you want the OPC UA EDS adapter to collect from the data sources.</p>
<h3 id="procedure-1">Procedure</h3>
<blockquote><p><strong>Note:</strong> You cannot modify OPC UA data selection configurations manually. You must use the REST endpoints to add or edit the configuration.</p>
</blockquote>
<p>Complete the following to configure OPC UA data selection:</p>
<ol>
<li>Using any text editor, create a file that contains an OPC UA data selection in JSON form.<ul>
<li>For content structure, see the following OPC UA data selection example.</li>
<li>For a table of all available parameters, see the following Parameters for <strong>OPC UA data selection</strong> section.</li>
</ul>
</li>
<li>Save the file as <em>DataSelection.config.json</em>.</li>
<li>Use any <a class="xref" href="../Administration/ManagementTools.html">tool</a> capable of making HTTP requests to execute a POST command with the contents of that file to the following endpoint: <code>http://localhost:5590/api/v1/configuration/&lt;EDS adapterId&gt;/DataSelection/</code><ul>
<li>Example using cURL:</li>
</ul>
</li>
</ol>
<pre><code class="lang-bash">curl -v -d &quot;@DataSelection.config.json&quot; -H &quot;Content-Type: application/json&quot; -X POST &quot;http://localhost:5590/api/v1/configuration/&lt;EDS adapterId&gt;/DataSelection&quot;
</code></pre><h3 id="parameters-for-opc-ua-data-selection">Parameters for OPC UA data selection</h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Required</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Selected</strong></td>
<td>Optional</td>
<td>bool</td>
<td>This field is used to select or clear a measurement. To select an item, set to true. To remove an item, leave the field empty or set to false.  If not configured, the default value is false.</td>
</tr>
<tr>
<td><strong>Name</strong></td>
<td>Optional</td>
<td>string</td>
<td>The optional friendly name of the data item collected from the data source. If not configured, the default value will be the stream id</td>
</tr>
<tr>
<td><strong>NodeId</strong></td>
<td>Required</td>
<td>string</td>
<td>The NodeId of the variable.</td>
</tr>
<tr>
<td><strong>StreamID</strong></td>
<td>Required</td>
<td>string</td>
<td>The custom stream ID that will be used to create the streams. If not specified, the Modbus TCP EDS adapter will generate a default stream ID based on the measurement configuration. A properly configured custom stream ID follows these rules:<br><br>Is not case-sensitive.<br>Can contain spaces.<br>Cannot start with two underscores (&quot;__&quot;).<br>Can contain a maximum of 260 characters.<br>Cannot use the following characters: / : ? # [ ] @ ! $ &amp; &#39; ( ) \ * + , ; = % &lt; &gt; &#124;<br>Cannot start or end with a period.<br>Cannot contain consecutive periods.<br>Cannot consist of only periods.</td>
</tr>
</tbody>
</table>
<h3 id="opc-ua-data-selection-example">OPC UA data selection example</h3>
<p>The following is an example of valid OPC UA Data Selection configuration:</p>
<pre><code class="lang-json">[
 {
    &quot;Selected&quot;: true,
    &quot;Name&quot;: &quot;Random1&quot;,
    &quot;NodeId&quot;: &quot;ns=5;s=Random1&quot;,
    &quot;StreamId&quot;: &quot;CustomStreamName&quot;
  },
  {
    &quot;Selected&quot;: false,
    &quot;Name&quot;: &quot;Sawtooth1&quot;,
    &quot;NodeId&quot;: &quot;ns=5;s=Sawtooth1&quot;,
    &quot;StreamId&quot;: null
  },
  {
    &quot;Selected&quot;: true,
    &quot;Name&quot;: &quot;Sinusoid1&quot;,
    &quot;NodeId&quot;: &quot;ns=5;s=Sinusoid1&quot;,
    &quot;StreamId&quot;: null
  }
]
</code></pre><h2 id="opc-ua-adapter-security">OPC UA adapter security</h2>
<p>The OPC UA security standard is concerned with the authentication of client and server applications, the authentication of users and confidentiality of their communication. As the security model relies heavily on Transport Level Security (TLS) to establish a secure communication link with an OPC UA server, each client, including the OSIsoft Adapter, must have a digital certificate deployed and configured. Certificates uniquely identify client applications and machines on servers, and allow for creation of a secure communication link when trusted on both sides.</p>
<p>OSIsoft Adapter for OPC UA generates a self-signed certificate when the first secure connection attempt is made. Each OPC UA Adapter instance creates a certificate store where its own certificates, as well as those of the server, will be persisted.</p>
<h3 id="procedure-2">Procedure</h3>
<ol>
<li>Configure the data source to use secure connection (Set UseSecureConnection as true).</li>
<li>Add server&#39;s certificate to the adapter&#39;s trust store.</li>
<li>Add adapter&#39;s certificate to the server&#39;s trust store.</li>
</ol>
<h3 id="data-source-configuration">Data source configuration</h3>
<pre><code class="lang-json">{
&quot;EndpointUrl&quot;: &quot;opc.tcp://IP-Address/TestOPCUAServer&quot;,
&quot;UseSecureConnection&quot;: true,
&quot;UserName&quot;: null,
&quot;Password&quot;: null,
&quot;RootNodeIds&quot;: null,
&quot;IncomingTimestamp&quot;: &quot;Source&quot;
}
</code></pre><blockquote><p><strong>Note:</strong> OSIsoft strongly recommends using secure connections in production environment(s).</p>
</blockquote>
<h3 id="adapter-certificate-store">Adapter Certificate store</h3>
<p>Adapter Certificate store location:</p>
<p>Windows: <code>%programdata%\OSIsoft\EdgeDataStore\{ComponentId}\Certificates</code></p>
<p>Linux: <code>/usr/share/OSIsoft/EdgeDataStore/{ComponentId}/Certificates</code></p>
<p>Adapter Trust store location:</p>
<p>Windows: <code>%programdata%\OSIsoft\EdgeDataStore\{ComponentId}\Certificates\Trusted\certs</code></p>
<p>Linux: <code>/usr/share/OSIsoft/EdgeDataStore/{ComponentId}/Certificates/Trusted/certs</code></p>
<p>Adapter Rejected certificates location:</p>
<p>Windows: <code>%programdata%\OSIsoft\EdgeDataStore\{ComponentId}\Certificates\RejectedCertificates\certs</code></p>
<p>Linux: <code>/usr/share/OSIsoft/EdgeDataStore/{ComponentId}/Certificates/RejectedCertificates/certs</code></p>
<p>The adapter verifies whether the server certificate is present in the adapter trust store location and is therefore trusted. In case the certificates were not exchanged upfront, the adapter persists the server certificate within the RejectedCertificates folder and the following warning message about the rejected server certificate will be printed:</p>
<pre><code class="lang-bash">~~2019-09-08 11:45:48.093 +01:00~~ [Warning] Rejected Certificate: &quot;DC=MyServer.MyDomain.int, O=Prosys OPC, CN=Simulation
</code></pre><p>After the certificate is reviewed and approved, it can be manually moved from the “RejectedCertificates\certs” folder to the “Trusted\certs&quot; folder using a file explorer or command-line interpreter.</p>
<ul>
<li>Linux example using command-line:</li>
</ul>
<pre><code class="lang-bash"> mv /usr/share/OSIsoft/EdgeDataStore/OpcUa1/Certificates/RejectedCertificates/certsSimulationServer\ \[F9823DCF607063DBCECCF6F8F39FD2584F46AEBB\].der /usr/share/OSIsoft/EdgeDataStore/OpcUa1/Certificates/Trusted/certs/
</code></pre><blockquote><p><strong>Note:</strong> Administrator or root privileges are required to perform this operation.</p>
</blockquote>
<p>When the certificate is in the adapter trust store, the adapter trusts the server and the connection attempt proceeds in making the  connection call to the configured server. Connection succeeds only when the adapter certificate is trusted on the server side. See your OPC UA server documentation for more details on how to make a client certificate trusted. In general, servers work in a similar fashion to the clients; hence a similar approach for making the server certificate trusted on the client side can be taken on the server.</p>
<p>When certificates are mutually trusted, the connection attempt succeeds and the adapter is connected to the most secure endpoint provided by the server.</p>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/osisoft/Edge-Data-Store-Docs/blob/master/V1/OpcUa/OpcUaOverview.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
            <span id='copyright-text'>© 2019 - OSIsoft, LLC.<span>
        </span></span></div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
